_format_version: "1.0"
table:
  name: MetaData
  schema: dbo
  description: "Central context aggregator linking every measurement to its full provenance (project, contact, equipment, parameter, procedure, unit, purpose, sampling point, and condition)"
  columns:
    - name: Metadata_ID
      logical_type: integer
      nullable: false
      identity: true
      description: "Surrogate primary key"
    - name: Project_ID
      logical_type: integer
      nullable: true
      description: "Links to the research or monitoring project"
      foreign_key:
        table: Project
        column: Project_ID
    - name: Contact_ID
      logical_type: integer
      nullable: true
      description: "Links to the person responsible for this measurement series"
      foreign_key:
        table: Person
        column: Person_ID
    - name: Equipment_ID
      logical_type: integer
      nullable: true
      description: "Links to the physical instrument that produced the measurements"
      foreign_key:
        table: Equipment
        column: Equipment_ID
    - name: Parameter_ID
      logical_type: integer
      nullable: true
      description: "Links to the measured analyte or parameter (e.g. TSS, pH)"
      foreign_key:
        table: Parameter
        column: Parameter_ID
    - name: Procedure_ID
      logical_type: integer
      nullable: true
      description: "Links to the standard operating procedure used"
      foreign_key:
        table: Procedures
        column: Procedure_ID
    - name: Unit_ID
      logical_type: integer
      nullable: true
      description: "Links to the measurement unit (e.g. mg/L)"
      foreign_key:
        table: Unit
        column: Unit_ID
    - name: Purpose_ID
      logical_type: integer
      nullable: true
      description: "Links to the measurement purpose (online, lab, calibration, validation)"
      foreign_key:
        table: Purpose
        column: Purpose_ID
    - name: Sampling_point_ID
      logical_type: integer
      nullable: true
      description: "Links to the physical sampling location"
      foreign_key:
        table: SamplingPoints
        column: Sampling_point_ID
    - name: Condition_ID
      logical_type: integer
      nullable: true
      description: "Links to the prevailing weather condition at time of measurement"
      foreign_key:
        table: WeatherCondition
        column: Condition_ID
    - name: ValueType_ID
      logical_type: integer
      nullable: false
      default: 1
      description: "Identifies the shape of stored values (1=Scalar, 2=Vector, 3=Matrix, 4=Image)"
      foreign_key:
        table: ValueType
        column: ValueType_ID
    - name: DataProvenance_ID
      logical_type: integer
      nullable: true
      description: "How this data was produced (Sensor, Laboratory, Manual Entry, Model Output, External Source). NULL for legacy rows; backfilled by migration."
      foreign_key:
        table: DataProvenance
        column: DataProvenance_ID
    - name: Campaign_ID
      logical_type: integer
      nullable: true
      description: "Campaign this measurement series belongs to. NULL for legacy rows."
      foreign_key:
        table: Campaign
        column: Campaign_ID
    - name: Sample_ID
      logical_type: integer
      nullable: true
      description: "Discrete sample analysed to produce this measurement series. Only populated for lab data (DataProvenance_ID=2)."
      foreign_key:
        table: Sample
        column: Sample_ID
    - name: Laboratory_ID
      logical_type: integer
      nullable: true
      description: "Laboratory where analysis was performed. Only populated for lab data (DataProvenance_ID=2)."
      foreign_key:
        table: Laboratory
        column: Laboratory_ID
    - name: AnalystPerson_ID
      logical_type: integer
      nullable: true
      description: "Person who performed the analysis. Only populated for lab data (DataProvenance_ID=2)."
      foreign_key:
        table: Person
        column: Person_ID

    - name: ProcessingDegree
      logical_type: string
      max_length: 50
      nullable: true
      default: "Raw"
      description: >
        Denormalized field indicating the level of processing applied to this
        time series. Ground truth is the DataLineage graph; this field exists
        for fast filtering. Set once at row creation and never changed â€” if the
        processing degree changes, a new MetaData row is created.
        Controlled vocabulary: Raw, Cleaned, Validated, Interpolated, Aggregated.
        Backfilled to 'Raw' for all rows existing before v1.6.0.
      value_set: processing_degree_set

    - name: StatusOfMetaDataID
      logical_type: integer
      nullable: true
      description: >
        If this MetaData entry is a status time series, this points 
        to the measurement MetaData entry it describes. NULL for 
        measurement entries and non-status entries.
      foreign_key:
        table: MetaData
        column: Metadata_ID

    - name: StatusOfEquipmentID
      logical_type: integer
      nullable: true
      description: >
        If this MetaData entry is a device-level status time series, 
        this points to the Equipment it describes. NULL for channel-
        level status and non-status entries.
      foreign_key:
        table: Equipment
        column: Equipment_ID

  check_constraints:
    - name: CK_MetaData_StatusTarget
      expression: "NOT (StatusOfMetaDataID IS NOT NULL AND StatusOfEquipmentID IS NOT NULL)"
      description: >
        A status entry is about either a measurement channel OR a 
        device, never both. At most one of StatusOfMetaDataID and 
        StatusOfEquipmentID can be non-NULL.

  primary_key: [Metadata_ID]
